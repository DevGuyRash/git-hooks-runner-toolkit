{
  "id": "snapshot_1761199131283_yqgwyrvjq",
  "approvalId": "approval_1761199131279_fotx3vr1j",
  "approvalTitle": "pre-commit-configured-actions tasks",
  "version": 1,
  "timestamp": "2025-10-23T05:58:51.282Z",
  "trigger": "initial",
  "status": "pending",
  "content": "- [ ] 1. Extract shared watcher library\n  - Files: lib/watch-configured-actions.sh (new), examples/watch-configured-actions.sh\n  - Move rule parsing, pattern matching, command execution, and mark-file logic into a reusable POSIX `sh` helper while adapting the existing post-event example to call the library.\n  - Purpose: Prevent duplication between post-event and pre-commit hooks and enable centralized config lookup.\n  - _Leverage: examples/watch-configured-actions.sh, lib/common.sh_\n  - _Requirements: 1, 2, 4_\n  - _Prompt: Role: POSIX Shell Developer specializing in reusable hook utilities | Task: Implement lib/watch-configured-actions.sh and refactor examples/watch-configured-actions.sh to consume it, fulfilling requirements 1, 2, and 4 by extracting shared logic and wiring centralized config discovery | Restrictions: Maintain POSIX sh compatibility, preserve existing logging semantics, do not alter behaviour for hooks not covered by requirements | _Leverage: examples/watch-configured-actions.sh, lib/common.sh_ | _Requirements: 1, 2, 4 | Success: Library provides reusable functions, existing post-event script delegates to it, tests for post-merge example keep passing_\n\n- [ ] 2. Implement pre-commit entrypoint\n  - File: examples/watch-configured-actions-pre-commit.sh (new)\n  - Create a thin wrapper that gathers staged changes, invokes shared library routines, and exposes metadata for the `pre-commit` hook.\n  - Purpose: Deliver pre-commit automation matching requirements while honouring centralized config.\n  - _Leverage: lib/watch-configured-actions.sh, lib/common.sh_\n  - _Requirements: 1, 4_\n  - _Prompt: Role: Git Hooks Engineer with expertise in pre-commit workflows | Task: Add a pre-commit entrypoint using lib/watch-configured-actions.sh to inspect staged changes and execute configured actions per requirements 1 and 4 | Restrictions: Use only POSIX sh constructs, ensure staged-only diffing, keep optional mark-file behaviour intact | _Leverage: lib/watch-configured-actions.sh, lib/common.sh_ | _Requirements: 1, 4 | Success: Script runs during pre-commit, honours centralized config, exits appropriately on matches and failures_\n\n- [ ] 3. Update installer staging for centralized configs\n  - Files: install.sh, examples/config/watch-configured-actions.yml (new location)\n  - Ensure example configs stage into `{hooks-root}/config/` with shared filenames for every install target (persistent and ephemeral) while emitting deprecation warnings when legacy paths are used.\n  - Purpose: Align staging pipeline with centralized config requirement.\n  - _Leverage: install.sh staging helpers, existing example asset layout_\n  - _Requirements: 2_\n  - _Prompt: Role: Shell Automation Developer focused on install tooling | Task: Modify install.sh staging logic so example configs land in {hooks-root}/config/watch-configured-actions.yml for all targets, satisfying requirement 2 | Restrictions: Preserve existing CLI flags/behaviour, handle ephemeral temp directories carefully, add warnings without breaking existing installs | _Leverage: install.sh staging helpers, examples directory structure_ | _Requirements: 2 | Success: Staging places config under central directory across install modes and legacy fallbacks warn correctly_\n\n- [ ] 4. Expand tests for hooks and installer\n  - Files: tests/examples/watch_configured_actions_pre_commit.sh (new), tests/examples/watch_configured_actions.sh, tests/test_git_hooks_examples.sh or relevant harness pieces\n  - Add coverage for pre-commit execution with centralized config, verify installer copies configs correctly in persistent and ephemeral modes, and ensure existing post-event tests still pass.\n  - Purpose: Guard against regressions introduced by refactor and config relocation.\n  - _Leverage: tests/examples/common.sh, ghr_* sandbox utilities_\n  - _Requirements: 1, 2, 3, 4_\n  - _Prompt: Role: QA Engineer experienced with shell-based integration tests | Task: Extend example tests to cover new pre-commit hook and centralized config staging, fulfilling requirements 1, 2, 3, and 4 | Restrictions: Keep tests POSIX-compliant, reuse sandbox helpers, ensure deterministic assertions for config paths | _Leverage: tests/examples/common.sh, existing watch_configured_actions tests_ | _Requirements: 1, 2, 3, 4 | Success: New tests pass and fail appropriately when behaviour regresses, and existing suites remain green_\n\n- [ ] 5. Document centralized config usage\n  - Files: docs/examples/watch-configured-actions.md, README.md\n  - Update documentation to explain shared `.githooks/config/watch-configured-actions.yml`, mention migration notices, and highlight pre-commit availability.\n  - Purpose: Communicate new configuration conventions per requirements.\n  - _Leverage: Existing docs content_\n  - _Requirements: 2, 4_\n  - _Prompt: Role: Technical Writer for developer tooling | Task: Revise docs to describe centralized config location, migration warnings, and new pre-commit support in alignment with requirements 2 and 4 | Restrictions: Maintain current documentation tone, avoid duplicating content, ensure instructions remain accurate for both persistent and ephemeral installs | _Leverage: docs/examples/watch-configured-actions.md, README.md_ | _Requirements: 2, 4 | Success: Documentation clearly directs users to centralized config, references new hook, and reflects runtime warnings_\n",
  "fileStats": {
    "size": 5374,
    "lines": 40,
    "lastModified": "2025-10-23T05:58:44.968Z"
  },
  "comments": []
}